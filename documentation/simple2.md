# Simple C2 framework

## Introduction
This file contains the documentation about the Command and Control (C2) framework named Simple.\
A C2 framework allows an attacker to communicate with the compromised victim machines after a successful cyber intrusion.\
Implants are executables generated by the C2 frameworks to create a backdoor.\
The attacker needs to drop, install and start the implant himself. 

To achieve this goal Simple uses the HTTP and HTTPS protocols to handle the communications between the server and the implants.


## Server and Implants
In Simple the server is an HTTP server that receives requests (GET only) from the implants.\
To send commands to the implants, the server waits for an HTTP request and then answers with a status code and a command can be send through the content field if needed.\
The server is in charge handling all communications. If the server is not connected then the implants only send UDP heartbeats messages.
The implants are in charge taking action by following the commands that are sent by the server.\
The implants also regularly send HTTP requests with a random file path to receive command from the server.


## Requests
The communications between the attacker HTTP server and the implants has the following structure:
- File extensions are used to communicate to the attacker the last order applied.
- File paths in the URI are used to communicate to the attacker the last task accepted.
- File paths are chosen randomly from the dictionaries described below.
- The attacker server uses the content field  and the status code in the HTTP answer to communicate with the implants.
- Commands sent in the content field are pre-determined in the implants.
    - For example, the `ls`command trigger a pre-determined function that returns the content of the current working directory on the implant.
    - Some commands can take parameters that need to be in the content field too.
    - Commands will never be split in several packets.
- When a command is sent by the attacker, the implants should reply with the appropriate extension.
- The valid URIs are predefined in the dictionaries described below.

**File extensions used:**
 - `.png`: Close communication. If the attacker server receives this extension it means that the kill command send before will be applied and all connections will be closed.
 - `.js`: Command accepted. If the attacker server receives this extension it means that the last command sent has been accepted and will be run.
 - `.php`:  Command declined. If the attacker server receives this extension it means that the last command sent has been declined and will not be run. 
 - `.html`: Connection and Data segment. If the attacker server receives this extension it means there is information in the packet sent by the implants.
    - examples:
        - This extension can be used to upload a file from the victim device to the attacker device.
        - This extension is used for the `ls`command described above.

**Format:**\
The requests made by the implants to the C2 server are predefined and have the following format:
- /{path}/file.extension.
`path` is optional and is randomly present or not in the URIs. Can be present once, several times or none.\
See the [dictionaries](#dictionaries) section to understand how are defined URIs used.



## Dictionaries
dictionaries contains URIs used by Simple C2 framework.\
dictionaries are splitted by extension to make more usual and not suspect URIs.

**dictionaries:**
- png dictionary
    - /images/mars/rover.png
    - /pictures/earth.png
    - /images/mars.png
    - /pictures/snowflake.png
    - /pictures/apollo/moon/landing.png
    - /pictures/apollo/ksc/saturn.png
    - /pictures/apollo/ksc/launch/saturn.png
    - /pictures/apollo/lander.png
    - /pictures/apollo/11/crew.png
    - /pictures/apollo/12/crew.png

- js dictionary
    - /scripts/search.js
    - /script/tracker.js
    - /scripts/stream/video.js
    - /scripts/stream/sound.js
    - /embedded/timer.js
    - /embedded/display.js
    - /script/load.js
    - /embedded/notification/popup.js

- php dictionary
    - /script/search.php
    - /scripts/login.php
    - /scripts/logout.php
    - /script/signin.php
    - /script/notification.php

- html dictionary
    - /static/home.html
    - /static/forum.html
    - /static/fr/index.html
    - /static/en/index.html
    - /static/en/home.html
    - /static/de/index.html
    - /static/login.html
    - /static/modular/notification.html
    - /static/modular/popup/login.html
    - /home.html
    - /login.html
    - /logout.html

## Usage
1. Install the implant on the victim's device (here you will just need to install Python and the required module).
2. Run the implant on the victim's device (`python3 implant.py <serverIP>`).
3. Run the server on the server device (`python3 server.py`).
4. Use `/help` to get a list of available commands.
5. Use the command you want in the server interface.


## Behaviour
Once the implants is started on the victime machine, it starts to send UDP heartbeats messages. These message are sent randomly with a minimal inter time of 30s and a maximal inter time of 2m.\

Once the C2 server receives a heartbeat, it checks if the client (victim) is already known. 
- If it is,  it updates the last time heard field. 
- If it is not, it add the new client to the list with the current timestamp as the last time heard field.

The server now know the new client and can connect to it.

To connect to a client the server answers a hearbeat with an UDP packet to the implant.
The implant has to answer with the `.html` extension in the first HTTP request it makes to approve the server connection.

When the attacker uses a command, the server waits for an HTTP request from the desired client.\
When it receives this request it answer with a status code and the appropriate content that refer to the desired command.

The client will receive the answer, and extract the command that is in the packet. It then answers with an HTTP request containing the appropriate file extension.\
Then, if the command has been accepted, the implant will run the command and answer the HTTP server with an HTTP request containing the answer in the data field.\
If the command is declined, the implant will answer with an URI containing the `.php` extension.

If the C2 server receives an HTTP request that does not match any dictionary it will be discarded and a code status 404 will be sent.

When a `kill` command is used, the implant answers with an HTTP request with the extension `.png`. Then, the implant waits for the HTTP answer to disconnect and to kill its processes.

When it receives a `disconnect` command the implant is still available and continues sending UDP heartbeat messages, but it stops sending HTTP requests. It also uses the `.png` extension to respond to this command in the next request.


