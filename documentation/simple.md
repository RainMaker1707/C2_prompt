# Slimper Command and Control framework.
## Introduction
This file contains the documentation about the Command and Control (C2) framework named Slimper.\
This framework is private and developped for educational purposes. This is the only documentation existing on this framework.

A C2 framework allows an attacker to communicate wirh the compromised victim machines after a successful cyber intrusion.

Implants are executables generated by the C2 framework to create a backdoor.
The operator of the C2 framework (attacker) needs to drop, install and start the execution of the implant himself.

To handle communication between the C2 server and the implants, Slimper uses the HTTP protocol.


Slimper uses a heartbeat system using HTTP requests. A heartbeat is a periodic signal generated by the implant to indicate its availability to the C2 server.


## Server and implants
In Slimper the C2 server is an internet-facing HTTP server that receives requests from the implants.\
Slimper only use GET and POST methods to handle its communication.

The C2 server is controlled by an operator (attacker) and communicates the commands to the implants and then receives the results of the executed commands.

To send command to the implants, the C2 server waits for an HTTP request from the implant and then responds with a HTTP response containing the command from the operator of the C2 server in its body.\
If no command are sent, the HTTP response body is empty.

The implants send heartbeat HTTP requests to the C2 Server. A hearbeat is a periodical signal generated to indicate its availability.\
If the HTTP response contains a command from the C2 server, the implant is in charge to execute it and returning the result in a POST request.

The URIs used in these HTTP requests are built as described in the following sections.



### File extensions
- **`.js`**: Used for heartbeat. It uses the GET method
- **``**: No extension are used for carrying data. It uses the POST method
- **`.png`**: Indicate that the HTTP requests from the implant will stop and the implant will kill its processes. It uses the GET method

### Dictionaries
```json
{
   "poll_ext": ".js",
   "poll_files": [
      "bootstrap",
      "bootstrap.min",
      "app",
      "array",
      "backbone",
      "script",
      "tracker",
   ],
   "poll_paths": [
      "assets",
      "scripts",
      "script",
      "javascripts",
      "javascript",
      "jscript",
      "embedded"
   ],
   "ext": "",
   "files": [
      "login",
      "signin",
      "api",
      "index",
      "admin",
      "register",
      "sign-up"
   ],
   "paths": [
      "api",
      "upload",
      "authenticate",
      "oauth",
      "oauth2",
      "database",
      "namespaces"
   ],
   "kill_ext": ".png",
   "kill_files": [
      "favicon",
      "mountain",
      "background",
   ],
   "kill_paths": [
      "static",
      "assets",
      "images",
      "icons",
      "image",
      "pictures",
   ]
}
```

### URI builder
The URIs used in the HTTP request made by the implants have the following format:
- `/{path}/{file}{extension}`
Where `{path}`, `{file}`and `{extension}` are replaced by word in the dictionaries above.

The extension used defines the path and file list used.
For example if the operator send a `kill`command to the implant then the `.png`extension is used and `{path}`and `{file}`will be respectively replaced by a word from  `kill_paths`and `kill_files`: `/{kill_paths}/{kill_files}.png`.\
Some URIs examples that are possible in the previous configuration:
- `/stativ/favicon.png`
- `/icons/favicon.png`
- `/picture/background.png`

The possibilities are then limitated from the extension used.
These format represent which dictionary is used for which part for any extensions.
- `/{poll_paths}/{poll_files}.js` (Get method)
    - Examples:
        - `/assest/bootstrap.min.js` is a correct example
        - `/script/tracker.js` is a correct example
        - `/icons/mountain.png` is **not** a correct example
- `/{paths}/{files}` (POST method)
    - Examples:
        - `/api/login` is a correct example
        - `/uppload/admin` is a correct example
        - `/assets/app` is **not** a correct example
- `/{kill_paths}/{kill_files}.png` (GET method)
    - Examples:
        - `/image/mountain.png` is a correct example
        - `/icons/favicon.png` is a correct example
        - `/api/login.png` is **not** a correct example

## Behaviour
Once the implant running on the victim's machine, it starts sending HTTP requests using the GET to the server using the `.js`extension to mimic a heartbeat.

Upon receiving the first hearbeat, the C2 server knows that an implant is available and can start respond with commands to the victim's machine.

The operator of the C2 server can then send command through the C2 server interface and the commands will be added in the next HTTP response.

The implant receiving an HTTP response, check if it contains a command.
If it contains a command, the implant execute the command and return the result in a HTTP request using the POST method. 

If the `kill`command is sent, the 

### Executions examples

#### Example 1: The operator send *kill* command
``` 
C2 Server -------------------------------  Implant
    |                                         |
    |  <------------------------------------  | GET /jscript/boostrap.min.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /scripts/array.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /javascript/backbone.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /embedded/app.js
    |  ------------------------------------>  | HTTP 200\ content:"kill"
    |  <------------------------------------  | GET /images/mountain.png
    |  ------------------------------------>  | HTTP 200\ content:empty
                                                  |-> implant kill its processes
```

#### Example 2: The operator send *ls* command wait for data and then send *kill* command
```
C2 Server -------------------------------  Implant
    |                                         |
    |  <------------------------------------  | GET /assets/boostrap.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /javascript/backbone.js
    |  ------------------------------------>  | HTTP 200\ content:"ls" 
                                                  |-> implant execute ls
    |  <------------------------------------  | POST /api/login <data results> 
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200\ content:"kill"
    |  <------------------------------------  | GET /images/mountain.png
    |  ------------------------------------>  | HTTP 200\ content:empty
                                                  |-> implant kill its processes
```

#### Example 3: The operator send "ls" and let the implant run
```
C2 Server -------------------------------  Implant
    |                                         |
    |  <------------------------------------  | GET /assets/boostrap.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /javascript/backbone.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /embedded/tracker.js
    |  ------------------------------------>  | HTTP 200\ content:"ls" 
                                                  |-> implant execute ls
    |  <------------------------------------  | POST /api/login <data results> 
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /jcripts/array.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    ... (continious hearbeat and response)
```

#### Example 4: Same as example 3 with inter-requests heartbeat
```
C2 Server -------------------------------  Implant
    |                                         |
    |  <------------------------------------  | GET /assets/boostrap.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /embedded/backbone.js
    |  ------------------------------------>  | HTTP 200\ content:"ls" 
                                                  |-> implant execute ls
    |  <------------------------------------  | GET /scripts/app.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | POST /api/login <data results> 
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /scripts/app.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /javascript/bootstrap.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    |  <------------------------------------  | GET /script/tracker.js
    |  ------------------------------------>  | HTTP 200\ content:empty
    ... (continious heartbeat and response)
```
