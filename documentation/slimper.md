# Slimper Command and Control framework.
## Introduction
This file contains the documentation about the Command and Control (C2) framework named Slimper.\
This framework is private and developed for educational purposes. This is the only documentation existing on this framework.

A C2 framework allows an attacker to communicate with the compromised victim machines after a successful cyber intrusion.

Implants are executables generated by the C2 framework to create a backdoor.
The operator of the C2 framework (attacker) needs to drop, install and start the execution of the implant himself.

To handle communication between the C2 server and the implants, Slimper uses the HTTP protocol.


Slimper uses a heartbeat system using HTTP requests. A heartbeat is a periodic signal generated by the implant to indicate its availability to the C2 server.


## Server and implants
In Slimper, the C2 server is an internet-facing HTTP server that receives requests from the implants.\
Slimper only uses GET and POST methods to handle its communication.

The C2 server is controlled by an operator (attacker), communicates the commands to the implants and then receives the results of the executed commands.

To send a command to an implant, the C2 server waits for an HTTP request from the implant and then responds with an HTTP response containing the command from the operator of the C2 server in its body.\
If no command is sent, the HTTP response body is empty.

The implants send heartbeat HTTP requests to the C2 Server. A heartbeat is a periodical signal generated to indicate the implant's availability.\
If the HTTP response contains a command from the C2 server, the implant is in charge to execute it and return the result in a POST request.

The URIs used in these HTTP requests are built as described in the following sections.



### File extensions
- **`.js`**: Used for heartbeat. It uses the GET method.
- **``**: No extension is used for carrying data. It uses the POST method.
- **`.png`**: Indicates that the HTTP requests from the implant will stop and the implant will kill its processes. It uses the GET method.

### Dictionaries
```json
{
   "poll_ext": ".js",
   "poll_files": [
      "bootstrap",
      "bootstrap.min",
      "app",
      "array",
      "backbone",
      "script",
      "tracker",
   ],
   "poll_paths": [
      "assets",
      "scripts",
      "script",
      "javascripts",
      "javascript",
      "jscript",
      "embedded"
   ],
   "ext": "",
   "files": [
      "login",
      "signin",
      "api",
      "index",
      "admin",
      "register",
      "sign-up"
   ],
   "paths": [
      "api",
      "upload",
      "authenticate",
      "oauth",
      "oauth2",
      "database",
      "namespaces"
   ],
   "kill_ext": ".png",
   "kill_files": [
      "favicon",
      "mountain",
      "background",
   ],
   "kill_paths": [
      "static",
      "assets",
      "images",
      "icons",
      "image",
      "pictures",
   ]
}
```

### URI builder
The URIs used in the HTTP request made by the implants have the following format:
- `/{path}/{file}{extension}`
Where `{path}`, `{file}`and `{extension}` are replaced by words from the dictionaries above.

The extension of the URI defines the path and file list to be used.
For example if the operator sends a `kill`command to the implant then the `.png`extension is used and `{path}`and `{file}`will be respectively replaced by a word from  `kill_paths`and `kill_files`: `/{kill_paths}/{kill_files}.png`.\
Here are some URIs examples that are possible in the previous configuration:
- `/static/favicon.png`
- `/icons/favicon.png`
- `/picture/background.png`

The URIs are limited by the extension that is used.
These formats represent which dictionary should be used depending on the extension:

- `/{poll_paths}/{poll_files}.js` (GET method)
    - Examples:
        - `/assets/bootstrap.min.js` is a correct example
        - `/script/tracker.js` is a correct example
        - `/icons/mountain.png` is an incorrect example
- `/{paths}/{files}` (POST method)
    - Examples:
        - `/api/login` is a correct example
        - `/upload/admin` is a correct example
        - `/assets/app` is an incorrect example
- `/{kill_paths}/{kill_files}.png` (GET method)
    - Examples:
        - `/image/mountain.png` is a correct example
        - `/icons/favicon.png` is a correct example
        - `/api/login.png` is an incorrect example

## Behaviour
Once the implant is running on the victim's machine, it starts sending HTTP requests to the C2 server with the GET method using the `.js` extension to mimic a heartbeat.

Upon receiving the first heartbeat, the C2 server knows that an implant is available, so it can start responding to the implant with commands.

The operator of the C2 server can then send command through the C2 server interface and the commands will be added in the next HTTP response.

The implant receiving an HTTP response checks if it contains a command.
If the HTTP response contains a command, the implant executes the command and returns the result in an HTTP request using the POST method. 

If the `kill` command is sent by the operator, the C2 server sends it in an HTTP response to the implant. The implant answers with an HTTP request with GET method using the `.png` extension. The implant then waits for the HTTP response from the C2 server and eventually kills its processes.
The communication between the C2 server and the implant stops from the HTTP response of the `.png` GET request.


### Executions examples

#### Example 1: The operator sends a *kill* command
``` 
C2 Server -------------------------------  Implant
    |                                         |
    |  <------------------------------------  | GET /jscript/bootstrap.min.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /scripts/array.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /javascript/backbone.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /embedded/app.js
    |  ------------------------------------>  | HTTP 200 content:"kill"
    |  <------------------------------------  | GET /images/mountain.png
    |  ------------------------------------>  | HTTP 200 content:empty
                                                  |-> the implant kills its processes
```

#### Example 2: The operator sends the *ls* command, waits for data and then sends the *kill* command
```
C2 Server -------------------------------  Implant
    |                                         |
    |  <------------------------------------  | GET /assets/bootstrap.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /javascript/backbone.js
    |  ------------------------------------>  | HTTP 200 content:"ls" 
                                                  |-> implant executes ls
    |  <------------------------------------  | POST /api/login <data results> 
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200 content:"kill"
    |  <------------------------------------  | GET /images/mountain.png
    |  ------------------------------------>  | HTTP 200 content:empty
                                                  |-> the implant kills its processes
```

#### Example 3: The operator sends the "ls" and lets the implant run
```
C2 Server -------------------------------  Implant
    |                                         |
    |  <------------------------------------  | GET /assets/bootstrap.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /javascript/backbone.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /embedded/tracker.js
    |  ------------------------------------>  | HTTP 200 content:"ls" 
                                                  |-> implant executes ls
    |  <------------------------------------  | POST /api/login <data results> 
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /jscripts/array.js
    |  ------------------------------------>  | HTTP 200 content:empty
    ... (continuous heartbeat and response)
```

#### Example 4: Same as example 3 with inter-requests heartbeat
```
C2 Server -------------------------------  Implant
    |                                         |
    |  <------------------------------------  | GET /assets/bootstrap.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /javascript/app.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /embedded/backbone.js
    |  ------------------------------------>  | HTTP 200 content:"ls" 
                                                  |-> implant executes ls
    |  <------------------------------------  | GET /scripts/app.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | POST /api/login <data results> 
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /scripts/app.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /javascript/bootstrap.js
    |  ------------------------------------>  | HTTP 200 content:empty
    |  <------------------------------------  | GET /script/tracker.js
    |  ------------------------------------>  | HTTP 200 content:empty
    ... (continuous heartbeat and response)
```
