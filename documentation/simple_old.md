# Slimper C2 framework

## Introduction
This file contains the documentation about the Command and Control (C2) framework named Slimper.\
A C2 framework allows an attacker to communicate with the compromised victim machines after a successful cyber intrusion.\
Implants are executables generated by the C2 frameworks to create a backdoor.\
The attacker needs to drop, install and start the implant himself. 

To achieve this goal Slimper uses the HTTP and HTTPS protocols to handle the communications between the server and the implants.

It uses a heartbeat system using HTTP request. A heartbeat is a periodic signal generated by the implant to indicate its availability to the attacker server.


## Server and Implants
In Slimper the server is an HTTP server that receives requests (GET & POST only) from the implants.\
To send commands to the implants, the server waits for an HTTP request and then answers with a status code and a command can be send through the content field if needed.\
The server is in charge handling all communications.
The implants are in charge taking action by following the commands that are sent by the server.\
The implants also regularly send HTTP requests with a random file path to receive command from the server.


## Requests
The communications between the attacker HTTP server and the implants have the following structure:
- File extension in the URI are used to communicate to the attacker the last task accepted. Extensions are described below.
- File paths are built randomly from the dictionaries described below.
- The attacker server uses the content field  and the status code in the HTTP answer to communicate with the implants.
- Commands sent in the content field are pre-determined in the implants.
    - For example, the `ls`command trigger a pre-determined function that returns the content of the current working directory on the implant.
    - Some commands can take parameters that need to be in the content field too.
    - Commands will never be split in several packets.
- When a command is sent by the attacker, the implants should reply with the appropriate extension.

**File extensions used:**
 - `.png`: Close communication. If the attacker server receives this extension it means that the kill command send before will be applied and all connections will be closed.
 - `.js`: Command accepted. If the attacker server receives this extension it means that the last command sent has been accepted and will be run.
           - This extension is also used for HTTP hearbeat.
 - `.php`:  Command declined. If the attacker server receives this extension it means that the last command sent has been declined and will not be run. 
 - `.html`: Connection and Data segment. If the attacker server receives this extension it means there is information in the packet sent by the implants.
    - examples:
        - This extension can be used to upload a file from the victim device to the attacker device.
        - This extension is used for the `ls`command described above.
        - When posting data it uses the POST method.
**Format:**\
The requests made by the implants to the C2 server are predefined and have the following format:
   - `.js` /{poll_paths}/{poll_files}.js
   - `.png` /{kill_paths}/{kill_files}.png
   - `.php` /{paths}/{files}.php 
   - `.html` /{paths}/{files}.html

See the [dictionaries](#dictionaries) section to understand how are built URIs used by Slimper.



## Dictionaries
Dictionaries contains URIs used by Slimper C2 framework.\
Dictionaries are defined as follows:

**dictionaries:**
```json
{
   "poll__and_accept_ext": ".js",
   "poll_files": [
      "bootstrap",
      "bootstrap.min",
      "app",
      "array",
      "backbone",
      "script",
      "tracker",
   ],
   "poll_paths": [
      "assets",
      "scripts",
      "script",
      "javascripts",
      "javascript",
      "jscript",
      "embedded"
   ],
   "start_and_data_ext": ".html",
   "reject_ext": ".php",
   "files": [
      "login",
      "signin",
      "api",
      "index",
      "admin",
      "register",
      "sign-up"
   ],
   "paths": [
      "api",
      "upload",
      "authenticate",
      "oauth",
      "oauth2",
      "database",
      "namespaces"
   ],
   "kill_ext": ".png",
   "kill_files": [
      "favicon",
      "mountain",
      "background",
   ],
   "kill_paths": [
      "static",
      "assets",
      "images",
      "icons",
      "image",
      "pictures",
   ]
}
```


## Usage
1. Install the implant on the victim's device (here you will just need to install Python and the required module).
2. Run the implant on the victim's device (`python3 implant.py <serverIP>`).
3. Run the server on the server device (`python3 server.py`).
4. Use `/help` to get a list of available commands.
5. Use the command you want in the server interface.


## Behaviour
Once the implant start on the victim's machine, it starts to send HTTP request to the server with `.js` extension to mimic hearbeat.

The attacker server now know that an implant is available and can start to send command to the victim's device.


If the attacker want to use a command, the command is added in the command queue.
The commands are sent in order (FIFO) in the content field of the HTTP answer.

The implant receiving a command should send a HTTP request to answer the server.\
If the extension used in this HTTP request is `.js` the command is accepted and will be executed.\
If the extension used in this HTTP request is `.php`, then the command has been rejected (not recognized command, need another command to run before, ...) and the implant wait for the next command.


If the attacker want to `disconnect` from the implant it will simply stop sending order to the implant. Which continues to send HTTP request with the `.js` extension as heartbeat.

If the attacker send a `kill`command, then the implant answer with an HTTP request containing the `.png` extension and then kill its own processes.